<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prestige Collection</title>

    <!-- Bulma CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">

    <!-- JQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

    <!-- Font - Noto Sans Korean semibold 600 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@600&display=swap" rel="stylesheet">

    <!-- Custom CSS & JS -->
    <link rel="stylesheet" href="./admin-Order.css" />
    <script src="/public/loadHTML.js"></script>
    <link rel="stylesheet" href="/public/Header/header.css" />
    <link rel="stylesheet" href="/public/Footer/footer.css" />

</head>
<body>
  <!-- Header -->
  <script>
    loadHTML("/public/Header/header.html");
  </script>
  
  <main class="main">
    <aside>
      <div class="side-menu" style="
        float: left;
        position: fixed;
        top: 100px;
        margin-top : 120px;
        margin-left : 250px;
        width: 200px; 
      ">
        <h3 class="title is-3">Admin</h3>
        <a class="active has-text-black" href="/admin/categories" style="font-weight: bold;">카테고리 관리</a><br />
        <a class="has-text-black" href="/admin/exhibits">상품 관리</a><br/>
        <a class="has-text-black" href="/admin/orders">주문 관리</a>
      </div>
    </aside>
    
    <section class="section" style="font-weight: 600 !important;">
      <div class="container" style="width: 50%;">
        <h1 class="title has-text-centered">주문 관리</h1>
        <!-- 주문 목록이 들어갈 영역 -->
        <div class="order-container">

        </div>
      </div>
    </section>
  </main>
  <!-- Footer -->
  <script>
    loadHTML("/public/Footer/footer.html");
  </script>

  <script>
    window.onload = function() {
      loadOrder();
    };

    // 날짜 변환
    function convertDate(date) {
      const currentTimeInMilliseconds = date;
      const currentTime = new Date(currentTimeInMilliseconds);

      const year = currentTime.getFullYear().toString().padStart(4, '0');
      const month = (currentTime.getMonth() + 1).toString().padStart(2, '0'); // 월은 0부터 시작하므로 +1 해줍니다.
      const day = currentTime.getDate().toString().padStart(2, '0');
      const hours = currentTime.getHours().toString().padStart(2, '0');
      const minutes = currentTime.getMinutes().toString().padStart(2, '0');
      const seconds = currentTime.getSeconds().toString().padStart(2, '0');

      const formattedTime = [`${year}-${month}-${day}`, `${hours}:${minutes}:${seconds}`];
      return formattedTime;
    }

    // 페이지 로드 시 주문 목록 렌더링
    function loadOrder() {
      // 주문 데이터 가져오기(주문번호(ID), 유저데이터.name(주문자명), 주문일자, 배송상태)
      let data = [[1, 
      {
        email : 'test@abc.com',
        name : "이름 1",
        user_address : "경기도 XX시 XX구 XX동 XX마을 XXX동 XXX호",
        phone : "010-1234-1234",
      }, convertDate(Date.now())[0],convertDate(Date.now())[1], '배송시작'], 
      [2, 
      {
        email : 'test@abc.com',
        name : "이름 2",
        user_address : "경기도 XX시 XX구 XX동 XX마을 XXX동 XXX호",
        phone : "010-1234-1234",
      }, convertDate(Date.now())[0],convertDate(Date.now())[1], '배송완료'], 
      [3, 
      {
        email : 'test@abc.com',
        name : "이름 3",
        user_address : "경기도 XX시 XX구 XX동 XX마을 XXX동 XXX호",
        phone : "010-1234-1234",
      }, convertDate(Date.now())[0],convertDate(Date.now())[1], '배송준비중'], 
      [4, 
      {
        email : 'test@abc.com',
        name : "이름 4",
        user_address : "경기도 XX시 XX구 XX동 XX마을 XXX동 XXX호",
        phone : "010-1234-1234",
      }, convertDate(Date.now())[0],convertDate(Date.now())[1], '배송완료'], 
      ];
      let order_Area = document.querySelector(".order-container");

      data.forEach(order => {
        order_Area.innerHTML += `
          <div class="card" style="margin-bottom: 20px">
            <header class="card-header">
              <p class="card-header-title">
                주문 정보
              </p>
            </header>
            <div class="card-content is-flex">
              <div class="content" style="flex: 1;">
                <p id="id${order[0]}" class="p_OrderID"><strong>주문번호 :</strong> ${order[0]}</p>
                <p><strong>주문자명 :</strong> ${order[1].name}</p>
                <p><strong>주문일자 :</strong> ${order[2]}</p>
                <p><strong>주문시간 :</strong> ${order[3]}</p>
                <p id="id${order[0]}" class="p_DeliveryStatus"><strong>배송상태 :</strong> ${order[4]}</p>
              </div>
              <div class="content" style="flex: 1;">
                <div class="select is-hovered">
                  <select id="id${order[0]}" class="delivery_Select">
                    <option>배송준비중</option>
                    <option>배송시작</option>
                    <option>배송완료</option>
                  </select>
                </div>
                <div>
                  <button id=${order[0]} onclick="order_Modify(this.id)">수정</button>
                  <button id=${order[0]} onclick="order_Delete(this.id)">삭제</button>
                </div>
              </div>
            </div>
          </div>
        `;
      });
    }

    // 주문 수정
    function order_Modify(id) {
      let deliverySelect = document.querySelector(`select#id${id}.delivery_Select`);
      let old_Delivery = document.querySelector(`p#id${id}.p_DeliveryStatus`);
      let old_DeliveryValue = old_Delivery.textContent.split(':')[1].trim();

      // 기존의 값과 새로 입력한 값이 다를 경우 Update
      if (old_DeliveryValue !== deliverySelect.value) {
        alert(`변경할 주문 데이터의 ID : ${id} / 변경할 배송상태 : ${deliverySelect.value}`);
        // 주문 데이터 Update
        // 주문 데이터 Load
      } else {
        alert(`선택한 배송상태가 이전 값과 같습니다.`);
      }
    }

    // 주문 삭제
    function order_Delete(id) {
      let isConfirmed = confirm('삭제하시겠습니까?');

      if (isConfirmed) {
        let orderId = id;
        alert(`삭제할 주문ID : ${orderId}`);
        // 주문 데이터 삭제 API
      }
    }
  </script>
</html>