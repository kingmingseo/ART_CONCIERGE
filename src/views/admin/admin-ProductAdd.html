<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prestige Collection</title>

    <!-- Bulma CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">

    <!-- JQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

    <!-- Font - Noto Sans Korean semibold 600 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@600&display=swap" rel="stylesheet">

    <!-- Data Picker -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <!-- Custom CSS & JS -->
    <script src="../public/loadHTML.js"></script>
    <link rel="stylesheet" href="../public/Header/header.css" />
    <link rel="stylesheet" href="../public/Footer/footer.css" />

</head>
<body>
    <!-- Header -->
    <script>
      loadHTML("../public/Header/header.html");
    </script>
  
    <main class="main">
      <aside>
        <div class="side-menu" style="
          float: left;
          position: fixed;
          top: 100px;
          margin-top : 120px;
          margin-left : 250px;
          width: 200px; 
        ">
          <h3 class="title is-3">Admin</h3>
          <a class="active has-text-black" href="#" style="font-weight: bold;">카테고리 관리</a><br />
          <a class="has-text-black" href="http://127.0.0.1:5501/views/admin/admin-Product.html">상품 관리</a><br/>
          <a class="has-text-black" href="#">주문 관리</a>
        </div>
      </aside>
      <section class="section">
        <div class="container" style="width: 50%;">
          <h1 class="title has-text-centered">상품 추가</h1>
          <form>
            <div class="container mt-1 px-4 py-3"
              style="border-top: solid #17171B 2px ; border-bottom: solid #17171B 2px ;"> 
              <div class="columns is-vcentered">
                <div class="column is-2">카테고리</div>
                <div class="column is-6">
                  <div class="select is-hovered">
                    <select id="category_Select">
                    </select>
                  </div>
                </div>
                <div class="column is-1"></div>
              </div>
              

              <div class="columns is-vcentered">
                <div class="column is-2 ">전시회 제목</div>
                <div class="column is-6"><input id="input_ExhibitName" type="text" class="input is-medium">
                </div>
              </div>
              
              <div class="columns is-vcentered">
                <div class="column is-2">작가 이름</div>
                <div class="column is-6"><input id="input_Author" type="text" class="input is-medium"></div>
                <div class="column is-1"></div>
              </div>
              <div class="columns is-vcentered">
                <div class="column is-2">전시 장소</div>
                <div class="column is-6"><input id="input_ExhibitPlace" type="tel" class="input is-medium"></div>
                <div class="column is-1"></div>
                <div class="column is-3"></div>
              </div>
              <div class="columns is-vcentered">
                <div class="column is-2">가격</div>
                <div class="column is-6"><input id="input_Price" type="text" class="input is-large"></div>
              </div>
              <div class="columns is-vcentered">
                <div class="column is-2">전시회 설명</div>
                <div class="column is-6"><input id="input_Description" type="text" class="input is-medium" value=""></div>
                <div class="column is-4"></div>
              </div>
              <div class="columns is-vcentered">
                <div class="column is-2">기간</div>
                <div class="column is-6">
                  <input type="text" id="datePicker" placeholder="Select date range" class="input is-medium">
                </div>
                <div class="column is-4"></div>
              </div>

              <div class="columns is-vcentered" id="imageUpload">
                <div class="column is-2">이미지 업로드</div>
                <div class="column is-6" id="uploadDiv" style="border: 2px dashed #ccc; padding: 20px; text-align: center;height: 300px;">
                  <input onchange="uploadImage()" type="file" id="uploadInput" accept="image/*" style="display: none;">
                  <label for="uploadInput">이미지 업로드</label>
                  <div id="previewImage" style="margin-top: 20px;"></div>
                </div>
              </div>
              
              <div class="columns is-vcentered">
                <div class="column is-3"></div>
                <div class="column is-3 columnhas-text-centered mt-6"> <button type="button" onclick="addProduct()" class="button is-large">추가</button></div>
                <div class="column is-3 has-text-centered mt-6"> <button type="button" onclick="moveToProduct()" class="button is-large">취소</button></div>
              </div>
    
          </form>
        </div>
      </section>
    </main>
    <script>
      window.onload = function() {
        loadData();
        initDatePicker();        
      };

      // 달력 초기화
      function initDatePicker() {
        flatpickr("#datePicker", {
          mode: "range", // 날짜 범위 선택 모드
          dateFormat: "Y-m-d", // 선택된 날짜의 형식
          onChange: function(selectedDates, dateStr, instance) {
            let startDate = selectedDates[0].toISOString().split('T')[0];
            let endDate = selectedDates[1] ? selectedDates[1].toISOString().split('T')[0] : "";
            let selectedRange = startDate + " ~ " + endDate;

            let input_DatePicker = document.getElementById('datePicker')
            input_DatePicker.textContent = selectedRange;
          }
        });
      }

      // 카테고리 전체 조회
      function loadData() {
        // 카테고리 데이터 조회 API
        let data = [[1, '카테고리1', 64], [2, '카테고리2', 13], [3, '카테고리3', 35], [4, '카테고리4', 51]];

        let element_Select = document.getElementById('category_Select');
        element_Select.innerHTML = "";

        data.forEach(category => {
          const optionElement = document.createElement("option");
          optionElement.textContent = category[1];
          element_Select.appendChild(optionElement);
        });
      }

      // 상품 추가
      function addProduct(){
        let category_Value = document.getElementById('category_Select').value;
        let exhibitName_Value = document.getElementById('input_ExhibitName').value;
        let author_Value = document.getElementById('input_Author').value;
        let place_Value = document.getElementById('input_ExhibitPlace').value;
        let price_Value = document.getElementById('input_Price').value;
        let description_Value = document.getElementById('input_Description').value;
        let duration_Value = document.getElementById('datePicker').value;
        let img_Value = document.getElementById('previewImage').querySelector('img').src;

        // 상품 추가 API
        alert(`${category_Value}, ${exhibitName_Value}, ${author_Value}, ${place_Value}, ${price_Value}, ${description_Value}, ${duration_Value}, ${img_Value}`);

        // 상품 페이지로 이동
        moveToProduct();
      }

      // 상품 페이지로 이동
      function moveToProduct() {
        let product_Page = 'http://127.0.0.1:5501/views/admin/admin-Product.html';
        window.location.href = product_Page;
      }

      // 이미지 업로드
      function uploadImage() {
        const file = document.getElementById('uploadInput').files[0];
        console.log(file);
        const reader = new FileReader();

        reader.onload = function(e) {
            const previewImageDiv = document.getElementById('previewImage');
            previewImageDiv.innerHTML = ''; // 이미지를 여러 번 업로드할 때 기존 이미지 제거

            const imageElement = document.createElement('img');
            imageElement.src = e.target.result;
            imageElement.style.maxWidth = '200px'; // 이미지 사이즈 조절
            previewImageDiv.appendChild(imageElement);
        };

        reader.readAsDataURL(file);
      }
    </script>
</html>